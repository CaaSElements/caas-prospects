<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../caas-crud-behavior/caas-crud-behavior.html">

<!--
`caas-prospects`
Polymer Prospects Element for Crowdfunding as a Service Solutions

@demo demo/index.html
-->

<dom-module id="caas-prospects">
  <template>

      <iron-ajax
        id="getItems"
        headers="[[_requestHeaders]]"
        url="[[apiEndpoint]]/accountmanager/prospects"
        method="GET"
        last-response="{{_apiData}}"
        debounce-duration="500"
        auto="[[autoDownload]]"
        loading="{{loadingItems}}"
        params="[[_queryParams]]"
      ></iron-ajax>

      <iron-ajax
        id="updateItem"
        headers="[[_requestHeaders]]"
        method="PUT"
        on-response="_handleUpdateItemResponse"
        on-error="_handleUpdateItemError"
        params="[[_queryParams]]"
        debounce-duration="500"
      ></iron-ajax>

  </template>

  <script>
    Polymer({

      is: 'caas-prospects',
      behaviors: [CaasCrudBehavior],

      properties: {

        /**
        * Name search string
        */
        searchName: {
          type: String,
          value: null
        },

        /**
        * Project name search string
        */
        searchProjectName: {
          type: String,
          value: null
        },

        /**
        * Account manager email search string
        */
        filterAccountManagerName: {
          type: String,
          value: null
        },

        /**
        * Search
        */
        searchQuery: {
          type: Object,
          computed: '_computeSearchQuery(searchName, searchProjectName, filterAccountManagerName)'
        },

      },

      _computeSearchQuery: function(searchName, searchProjectName, filterAccountManagerName) { 

        return [
          {
            "OR": {
              "aanmeldnaam": encodeURIComponent(searchName) || "",
              "projectnaam": encodeURIComponent(searchProjectName) || "",
            }
          },
          {
            "AND": {
              "accountmanager": filterAccountManagerName || ""
            }
          }
        ]

      },

      _parseApiDataItemToItem: function(apiDataItem) {
        
        return {
          savedOn: apiDataItem.savedOn,
          id: apiDataItem.id,
          emailAddress: apiDataItem.emailAddress,
          createdOn: apiDataItem.createdOn,
          score: apiDataItem.score,
          fullName: apiDataItem.fullName,
          phoneNumber: apiDataItem.phoneNumber,
          organisationName: apiDataItem.organisationName,
          websiteURL: apiDataItem.websiteURL,
          region: apiDataItem.region,
          reference: apiDataItem.reference,
          comments: apiDataItem.comments,
          status: apiDataItem.status,
          action: apiDataItem.action,
          accountmanager: apiDataItem.accountmanager,
          progress: apiDataItem.progress,
          followUp: apiDataItem.followUp,
          desiredCapital: apiDataItem.desiredCapital,
          fundingType: apiDataItem.fundingType,
          KvKRegistrationTime: apiDataItem.KvKRegistrationTime,
          inspiredBy: apiDataItem.inspiredBy,
          prominentCustomers: apiDataItem.prominentCustomers,
          networkCommitmentScore: apiDataItem.networkCommitmentScore,
          toBeCalled: apiDataItem.toBeCalled,
          mailed: apiDataItem.mailed,
          called: apiDataItem.called,
          talked: apiDataItem.talked,
          placeAble: apiDataItem.placeAble,
          toBeMailed: apiDataItem.toBeMailed,
          scorePercentage: apiDataItem.scorePercentage,
          flagged: apiDataItem.flagged,
          savedScorePercentage: apiDataItem.savedScorePercentage,
          testResults: apiDataItem.testResults
        }

      }

    });
  </script>
</dom-module>
